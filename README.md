# MTGDllInjector

MTGDllInjector is a proof-of-concept, multi-project solution intended to demonstrate DLL injection techniques into a running process, along with duplex IPC communication via Named Pipes.  
Originally created for research and experimentation involving the Windows client of **Magic: The Gathering Online (MTGO)**, the solution provides a technical foundation for plugin systems, runtime inspection, or automation scenarios.

‚ö† **Disclaimer**  
This project is intended **for educational and demonstrational purposes only**.  
The author **accepts no liability for misuse**, damage, legal consequences, or unauthorized tampering with third-party applications. Users are solely responsible for ensuring that running this project complies with all local laws, EULAs, and terms of service.

---

## ‚ú® Features

- Injection of a **Managed .NET DLL**
- Injection of a **Native C++ DLL**
- Automatic execution on DLL load through the native library
- Bidirectional IPC using **Named Pipes**
- Extensible architecture for custom entry points and logic
- Works as a foundation for modding, plugin execution, or application research

---

## üõ† Technical Architecture Notes

Because **C# does not support automatic entry execution when a DLL is loaded** by a target process (i.e., there is no managed equivalent of `DllMain`), the project utilizes a **Native C++ DLL** which exposes a proper `DllMain` entry point.

This native entry point:

- Executes as soon as the DLL is mapped into the target process
- Bootstraps and loads the Managed .NET library
- Initializes IPC communication channels
- Invokes managed logic after initialization completes

This hybrid architecture is required in cases where automatic execution upon injection is desired in managed environments.

---

## üß© Project Structure

| Project | Description |
|---------|------------|
| **InjectorApp** | Console application responsible for injecting DLLs and managing IPC |
| **ManagedLibrary** | Injected managed .NET library executed after bootstrap |
| **NativeLibrary** | Injected native C++ DLL containing `DllMain` |
| **Common** | Shared contracts and configuration |

---

## üß∞ Technologies Used

| Component | Technology |
|----------|-----------|
| Managed embedded DLL | C# (.NET) |
| Bootstrap and immediate entry | C++ |
| Communication | Named Pipes (IPC) |
| Code weaving / IL manipulation | Fody |
| IDE / Build System | Visual Studio |

---

## üöÄ Build & Run

### Prerequisites

- **Windows**
- **Visual Studio 2022**
- **.NET SDK (7+)**
- **Desktop C++ development tools**

### Build

***From Visual Studio***
- Open the solution: **MTGDllInjector.slnx**
- Compile in: Release / x64

***From Terminal***
- Exec the following command:
```bash
msbuild MTGDllInjector.slnx /t:Restore; msbuild MTGDllInjector.slnx /p:Configuration=Release /p:Platform=x64
```

> You can use the **MTGDllInjector.sln** file as well for the **Terminal** Build

> The injected DLLs **must match the architecture** of the target process.

<br>
**Note**: If you want an InjectorApp.exe that can run independently outside its build folder, then you need to execute the following command inside the /InjectorApp folder 

```bash
dotnet publish -c Release
```
This will generate an indipendent exe file inside *InjectorApp\bin\Release\net8.0\win-x64\publish*

---

## ‚ñ∂ Running the Injector

To run this program you need:
1. The ***InjectorApp.exe*** file in the *InjectorApp/Bin/Release/net8.0* folder
2. The ***NativeLibrary.dll*** that will be autogenerated in the *x64/Release* folder
    1. ***ManagedLibrary.dll*** will also be generated in the same path and must be in the same path as NativeLibrary.dll because it's the actual dll that will be injected inside the process

There are 2 ways to run the program:
1. Using the processId and the DLL path:
    ```bash
    InjectorApp.exe <PROCESS_ID> <PATH_TO_NativeLibrary.dll>
    ```
2. Using the path of the Magic The Gathering.appref-ms file (this will automatically start the app)
    ```bash
    InjectorApp.exe --appref <PATH_TO_APPREF_FILE> <PATH_TO_NativeLibrary.dll>
    ```
---

## üîç Intended Demonstration Scenario

This project was originally developed to demonstrate DLL injection behavior into the Magic: The Gathering Online application.
Its main purpose is to showcase technical patterns such as:
- DLL bootstrap strategies
- Native-to-managed initialization
- IPC communication inside foreign processes

---

## ‚öñ Legal Disclaimer

This project:

- Does not endorse modifying third-party software
- Must not be used to bypass security or licensing
- Is provided "as-is" with no warranty

The author assumes no responsibility or liability for the use of this code.
